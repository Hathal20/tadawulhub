<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TadawulHub</title>

  <!-- Tailwind (development CDN) -->
  <script defer src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts & local CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='spinner.css') }}">

  <style>
    body { font-family: 'Inter', sans-serif; }

    /* global loader */
    #loadingOverlay {
      position: fixed; inset: 0;
      display: flex; align-items: center; justify-content: center;
      background: rgba(0,0,0,.3);
      visibility: hidden; opacity: 0;
      transition: visibility 0s, opacity .3s;
      z-index: 50;
    }
    #loadingOverlay.show { visibility: visible; opacity: 1; }

    .autocomplete-item:hover { background: #f7f7f7; }
    .watchlist-item:hover    { background: #f0f0f0; cursor: pointer; }

    /* chart sizing */
    #chart    { min-height: 400px; height: calc(70vh - 110px); }
    #rsiChart { min-height: 150px; }

    /* floating symbol box */
    #symbolBox {
      position: absolute; top: 8px; left: 8px;
      background: rgba(0,0,0,0.65); color: #fff;
      padding: 4px 10px; border-radius: 6px;
      font-size: 0.9rem; z-index: 5; pointer-events: none;
    }
  </style>

  <!-- 3rd-party libs -->
  <script defer src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <!-- Your front-end logic -->
  <script defer src="{{ url_for('static', filename='main.js') }}"></script>
</head>

<body class="bg-white text-black">
  <!-- ===== Header ===== -->
  <header class="p-4 bg-blue-600 text-white flex flex-wrap justify-between items-center w-full overflow-hidden">
    <div class="flex items-center space-x-4 flex-shrink-0">
      <img src="{{ url_for('static', filename='logo.svg') }}" alt="Logo" class="h-14">
      <span class="text-3xl font-bold whitespace-nowrap">TadawulHub</span>
    </div>

    <nav class="flex flex-wrap justify-center gap-4 mt-4 md:mt-0 text-lg w-full md:w-auto">
      <a href="/"          class="hover:underline">الرئيسية</a>
      <a href="/watchlist" class="hover:underline">قائمة الشركات</a>
      <a href="/signup"    class="font-semibold underline">تسجيل</a>
      <a href="/about"     class="hover:underline">About</a>
    </nav>
  </header>

  <!-- ===== Loader ===== -->
  <div id="loadingOverlay"><div class="loader">Loading…</div></div>

  <!-- ===== Layout ===== -->
  <div class="flex h-screen overflow-hidden">

    <!-- === left: toolbar + charts === -->
    <div class="flex-grow flex flex-col overflow-auto">
      <!-- toolbar (unchanged) -->
      <!-- … your toolbar & drawing-tools code stays exactly as you had … -->

      <!-- ===== charts ===== -->
      <main id="mainContainer" class="flex-grow flex flex-col relative bg-white">
        <!-- floating company box -->
        <div id="symbolBox" class="hidden">TASI — ^TASI.SR</div>

        <div id="chart"        class="flex-grow"></div>
        <div id="noDataMessage" class="hidden absolute inset-0 flex items-center justify-center text-xl text-gray-500 font-semibold">
          No data available
        </div>
        <div id="rsiChart"     class="h-1/4"></div>
      </main>

      <footer class="p-2 text-center text-xs text-gray-500 border-t">
        <span id="lastUpdated">Last Updated –</span>
      </footer>
    </div>

    <!-- === collapsible sidebar === -->
    <div id="sidebarWrap" class="relative h-full">
      <aside id="watchlist"
             class="p-4 bg-gray-50 text-black w-64 border-l overflow-auto
                    transition-transform duration-300 transform translate-x-0">
        <h3 class="font-bold text-lg mb-4 text-blue-800">Watchlist</h3>
        <div id="watchlistContent" class="space-y-4 text-sm"></div>
      </aside>

      <!-- arrow lever -->
      <button id="sidebarToggle"
              class="absolute -left-5 top-1/2 -translate-y-1/2
                     bg-blue-600 text-white w-5 h-12 flex items-center justify-center
                     rounded-l hover:bg-blue-700 focus:outline-none">
        ‹
      </button>
    </div>
  </div>

  <!-- ===== sidebar toggle + floating box logic ===== -->
  <script>
    // --- sidebar ---
    const toggleBtn = document.getElementById('sidebarToggle');
    const sidebar   = document.getElementById('watchlist');
    let hidden = false;
    toggleBtn.addEventListener('click', () => {
      hidden = !hidden;
      sidebar.classList.toggle('-translate-x-full', hidden);
      toggleBtn.textContent = hidden ? '›' : '‹';
    });

    // --- floating symbol name (example) ---
    // after your JS fetches data & knows "symbol" + "name", set them:
    //   setSymbolBox("أرامكو","2222.SR");
    function setSymbolBox(name, symbol){
      const box = document.getElementById('symbolBox');
      box.textContent = `${name} — ${symbol}`;
      box.classList.remove('hidden');
    }
    // you can call setSymbolBox() from main.js whenever user searches.
  </script>
</body>
</html>
